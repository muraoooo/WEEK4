# 管理画面ダッシュボードシステム - 完全ガイド

## 📋 目次
1. [システム概要](#システム概要)
2. [ディレクトリ構造](#ディレクトリ構造)
3. [主要コンポーネントの説明](#主要コンポーネントの説明)
4. [データフローの仕組み](#データフローの仕組み)
5. [各ページの機能説明](#各ページの機能説明)
6. [技術スタック](#技術スタック)
7. [セットアップ方法](#セットアップ方法)

---

## システム概要

このシステムは、ウェブアプリケーションの管理者が使用する**管理画面（Admin Dashboard）**です。
ユーザーの活動、投稿内容、セキュリティ状況などを一元管理できる包括的な管理ツールとなっています。

### 🎯 主な目的
- **監視**: ユーザー活動やシステムの状態をリアルタイムで監視
- **管理**: ユーザー、投稿、セッションなどの管理
- **セキュリティ**: セキュリティレポートの確認
- **設定**: システム全体の設定変更

---

## ディレクトリ構造

```
secure-session-system/
├── 📁 app/                          # Next.jsのアプリケーションフォルダ
│   ├── 📁 admin/                    # 管理画面関連
│   │   ├── 📁 dashboard/            # ダッシュボード
│   │   │   └── 📄 page.tsx          # メインダッシュボードページ
│   │   ├── 📁 users/                # ユーザー管理
│   │   │   └── 📄 page.tsx          # ユーザー一覧・管理ページ
│   │   ├── 📁 sessions/             # セッション管理
│   │   │   └── 📄 page.tsx          # アクティブセッション管理
│   │   ├── 📁 posts/                # 投稿管理
│   │   │   └── 📄 page.tsx          # 投稿の監視・モデレーション
│   │   ├── 📁 reports/              # レポート
│   │   │   └── 📁 security/         # セキュリティ
│   │   │       └── 📄 page.tsx      # セキュリティレポートページ
│   │   ├── 📁 settings/             # 設定
│   │   │   └── 📄 page.tsx          # システム設定ページ
│   │   └── 📄 layout.tsx            # 管理画面共通レイアウト
│   │
│   └── 📁 api/                      # APIエンドポイント
│       └── 📁 admin/                 # 管理画面用API
│           ├── 📁 dashboard/        
│           │   └── 📄 route.ts      # ダッシュボードデータAPI
│           ├── 📁 users/            
│           │   └── 📄 route.ts      # ユーザーデータAPI
│           ├── 📁 sessions/         
│           │   └── 📄 route.ts      # セッションデータAPI
│           ├── 📁 posts/            
│           │   └── 📄 route.ts      # 投稿データAPI
│           ├── 📁 security/         
│           │   └── 📄 route.ts      # セキュリティデータAPI
│           └── 📁 settings/         
│               └── 📄 route.ts      # 設定データAPI
│
├── 📁 components/                   # 再利用可能なコンポーネント
│   └── 📁 admin/
│       └── 📁 dashboard/
│           ├── 📄 StatCard.tsx      # 統計カードコンポーネント
│           ├── 📄 Charts.tsx        # グラフコンポーネント
│           └── 📄 ActivityFeed.tsx  # アクティビティフィード
│
└── 📁 lib/                          # ユーティリティ
    └── 📄 database.ts               # データベース接続

```

---

## 主要コンポーネントの説明

### 1. 📊 ダッシュボード (`app/admin/dashboard/page.tsx`)

**概要**: 管理画面のメインページで、システム全体の状態を一目で把握できます。

**主な機能**:
- **統計カード**: 重要な数値を大きく表示
  - 総ユーザー数
  - 総投稿数
  - 通報数
  - システム稼働率
- **グラフ表示**:
  - 折れ線グラフ: 過去7日間のユーザー登録推移
  - 円グラフ: デバイス別アクセス割合（Desktop/Mobile/Tablet）
- **アクティビティフィード**: 最新の活動をリアルタイム表示
- **自動更新**: 30秒ごとにデータを自動更新

### 2. 📇 統計カード (`components/admin/dashboard/StatCard.tsx`)

**役割**: 重要な数値データを視覚的に表示するカードコンポーネント

**特徴**:
- アイコン付きの見やすいデザイン
- 前日比の増減を矢印で表示（↑増加/↓減少）
- 色分けによる状態表示（良好:緑、警告:黄、エラー:赤）

### 3. 📈 グラフコンポーネント (`components/admin/dashboard/Charts.tsx`)

**役割**: データを視覚化するグラフを表示

**グラフの種類**:
- **LineChart（折れ線グラフ）**: 時系列データの推移を表示
- **PieChart（円グラフ）**: 割合や比率を表示
- **BarChart（棒グラフ）**: 項目別の比較を表示

### 4. 📰 アクティビティフィード (`components/admin/dashboard/ActivityFeed.tsx`)

**役割**: システム内の最新の活動を時系列で表示

**表示内容**:
- ユーザーの新規登録
- 新しい投稿
- セキュリティアラート
- システムイベント

---

## データフローの仕組み

```mermaid
graph TB
    A[ブラウザ] -->|リクエスト| B[Next.js ページ]
    B -->|データ取得| C[API エンドポイント]
    C -->|クエリ| D[MongoDB データベース]
    D -->|データ返却| C
    C -->|JSON レスポンス| B
    B -->|表示| A
    
    E[30秒タイマー] -->|自動更新| B
```

### データ取得の流れ

1. **ページ読み込み時**:
   - ページコンポーネントがマウントされる
   - `useEffect`フックでAPIを呼び出し
   - データを取得して画面に表示

2. **定期更新**:
   - 30秒ごとに`setInterval`でAPIを再呼び出し
   - 新しいデータで画面を更新
   - ユーザーは常に最新情報を確認可能

3. **エラー処理**:
   - API呼び出し失敗時はエラーメッセージを表示
   - 再試行ボタンで手動更新可能

---

## 各ページの機能説明

### 🏠 ダッシュボード
**パス**: `/admin/dashboard`

リアルタイムでシステムの状態を監視できるメインページです。

**主要指標**:
- ユーザー数の推移
- アクティブセッション数
- 投稿の増加率
- システムパフォーマンス

### 👥 ユーザー管理
**パス**: `/admin/users`

登録ユーザーの一覧表示と管理を行います。

**機能**:
- ユーザー検索（名前、メール）
- アカウントの有効化/無効化
- ロール（権限）の変更
- 最終ログイン日時の確認
- ページネーション（ページ分け）

### 🔐 セッション管理
**パス**: `/admin/sessions`

現在アクティブなセッションを監視・管理します。

**機能**:
- アクティブセッション一覧
- セッションの強制終了
- IPアドレスの確認
- デバイス情報の表示
- 不審なアクセスの検出

### 📝 投稿管理
**パス**: `/admin/posts`

ユーザーの投稿内容を監視・モデレーションします。

**機能**:
- 投稿内容のプレビュー
- 不適切な投稿の削除/非表示
- 投稿者情報の確認
- いいね数・コメント数の表示
- 通報された投稿の優先表示

### 🛡️ セキュリティレポート
**パス**: `/admin/reports/security`

セキュリティ関連の情報を集約表示します。

**監視項目**:
- セキュリティスコア（100点満点）
- ログイン失敗の追跡
- 不審なIPアドレス
- ブロックされたアクセス
- セキュリティ推奨事項

### ⚙️ システム設定
**パス**: `/admin/settings`

システム全体の設定を管理します。

**設定カテゴリ**:
1. **一般設定**: サイト名、言語、タイムゾーン
2. **セキュリティ**: パスワードポリシー、セッションタイムアウト
3. **メール設定**: SMTP設定、通知メール
4. **ストレージ**: アップロード制限、バックアップ
5. **通知設定**: アラート、通知の有効/無効
6. **API設定**: レート制限、CORS、Webhook

---

## 技術スタック

### フロントエンド
- **Next.js 15**: Reactベースのフレームワーク
- **TypeScript**: 型安全な開発
- **Material-UI (MUI)**: UIコンポーネントライブラリ
- **Chart.js**: グラフ描画ライブラリ
- **React Hooks**: 状態管理

### バックエンド
- **Next.js API Routes**: サーバーレスAPI
- **MongoDB**: NoSQLデータベース
- **Mongoose**: MongoDBのODM（オブジェクトデータマッピング）

### 主要な技術的特徴

1. **Server Components**: 
   - サーバー側でレンダリング
   - パフォーマンスの向上

2. **Client Components** (`'use client'`):
   - インタラクティブな要素
   - リアルタイム更新

3. **レスポンシブデザイン**:
   - モバイル、タブレット、デスクトップ対応
   - グリッドレイアウトシステム

---

## セットアップ方法

### 1. 必要な環境
- Node.js 18以上
- MongoDB（クラウド版も可）
- npmまたはyarn

### 2. インストール手順

```bash
# リポジトリのクローン
git clone [repository-url]
cd secure-session-system

# 依存関係のインストール
npm install

# 環境変数の設定
# .env.localファイルを作成し、以下を追加
MONGODB_URI=mongodb+srv://[username]:[password]@cluster0.mongodb.net/[database]

# 開発サーバーの起動
npm run dev

# ブラウザでアクセス
# http://localhost:3000/admin/dashboard
```

### 3. 初回セットアップ
1. MongoDBに接続
2. 必要なコレクションが自動作成される
3. テストデータの投入（オプション）

---

## 使い方ガイド

### 基本的な操作フロー

1. **ログイン** → 管理者権限でログイン
2. **ダッシュボード確認** → システム全体の状態を把握
3. **詳細ページへ移動** → 必要に応じて各管理ページへ
4. **アクション実行** → ユーザー管理、投稿削除など
5. **レポート確認** → 統計やセキュリティ状況を分析

### よくある使用シナリオ

#### シナリオ1: 不適切な投稿への対処
1. ダッシュボードでアラート確認
2. 投稿管理ページへ移動
3. 問題の投稿を特定
4. 削除または非表示に設定

#### シナリオ2: 不審なアクセスの調査
1. セキュリティレポートを確認
2. 不審なIPアドレスを特定
3. セッション管理で該当セッションを終了
4. 必要に応じてIPをブロック

#### シナリオ3: システム設定の変更
1. 設定ページへアクセス
2. 該当するタブを選択
3. 設定値を変更
4. 保存ボタンをクリック

---

## まとめ

この管理画面システムは、ウェブアプリケーションの運営に必要な機能を網羅的に提供します。
リアルタイムでの監視、効率的な管理、詳細な分析が可能で、システムの安定運用を支援します。

### 主な特徴
- ✅ **リアルタイム更新**: 30秒ごとの自動更新
- ✅ **包括的な管理**: ユーザー、投稿、セッションの一元管理
- ✅ **セキュリティ重視**: 詳細なセキュリティ監視とレポート
- ✅ **使いやすいUI**: Material-UIによる直感的なインターフェース
- ✅ **拡張性**: モジュラー設計により機能追加が容易

このシステムにより、管理者は効率的にアプリケーションを運営し、
ユーザーに安全で快適なサービスを提供することができます。