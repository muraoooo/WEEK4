# å®Œå…¨ã‚·ã‚¹ãƒ†ãƒ æ§‹ç¯‰ã‚¬ã‚¤ãƒ‰ - ã‚¼ãƒ­ã‹ã‚‰å‹•ãã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹

## ğŸ“š ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã¨å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](#1-ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã¨å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£)
2. [ç’°å¢ƒæ§‹ç¯‰ã¨åˆæœŸè¨­å®š](#2-ç’°å¢ƒæ§‹ç¯‰ã¨åˆæœŸè¨­å®š)
3. [MongoDB Atlas ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—](#3-mongodb-atlas-ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—)
4. [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®è©³ç´°](#4-ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®è©³ç´°)
5. [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ã‚¹ã‚­ãƒ¼ãƒ](#5-ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ã‚¹ã‚­ãƒ¼ãƒ)
6. [èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](#6-èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£)
7. [ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…](#7-ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…)
8. [æŠ•ç¨¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…](#8-æŠ•ç¨¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…)
9. [é€šå ±ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…](#9-é€šå ±ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…)
10. [ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ ](#10-ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ )
11. [ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•](#11-ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•)
12. [é–‹ç™ºæ™‚ã®é‡è¦ãªæ³¨æ„ç‚¹](#12-é–‹ç™ºæ™‚ã®é‡è¦ãªæ³¨æ„ç‚¹)

---

## 1. ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦ã¨å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ã‚·ã‚¹ãƒ†ãƒ ã®ç›®çš„
ã“ã®ã‚·ã‚¹ãƒ†ãƒ ã¯ã€SNSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã€ŒSurvibeã€ã®ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã€æŠ•ç¨¿ç®¡ç†ã€é€šå ±å‡¦ç†ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ãªã©ã€SNSãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«å¿…è¦ãªç®¡ç†æ©Ÿèƒ½ã‚’ã™ã¹ã¦æä¾›ã—ã¾ã™ã€‚

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

```
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰:
â”œâ”€â”€ Next.js 14 (App Router)
â”œâ”€â”€ TypeScript
â”œâ”€â”€ Material-UI v5
â””â”€â”€ React 18

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰:
â”œâ”€â”€ Next.js API Routes
â”œâ”€â”€ MongoDB (Mongoose)
â””â”€â”€ Node.js

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹:
â””â”€â”€ MongoDB Atlas (ã‚¯ãƒ©ã‚¦ãƒ‰DB)

èªè¨¼ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£:
â”œâ”€â”€ JWT (JSON Web Tokens)
â”œâ”€â”€ bcryptjs (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–)
â””â”€â”€ ç’°å¢ƒå¤‰æ•°ã«ã‚ˆã‚‹ç§˜å¯†æƒ…å ±ç®¡ç†

ãƒ¡ãƒ¼ãƒ«é€ä¿¡:
â””â”€â”€ Nodemailer (SMTP)
```

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ãƒ–ãƒ©ã‚¦ã‚¶ (Client)               â”‚
â”‚         Material-UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ HTTP/HTTPS
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Next.js Application                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚          App Router (Pages)               â”‚   â”‚
â”‚  â”‚  /admin/users, /admin/posts, etc.        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚         API Routes (Backend)              â”‚   â”‚
â”‚  â”‚  /api/admin/users, /api/admin/posts      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   MongoDB Atlas       â”‚
         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚  â”‚ users          â”‚   â”‚
         â”‚  â”‚ posts          â”‚   â”‚
         â”‚  â”‚ reports        â”‚   â”‚
         â”‚  â”‚ audit_logs     â”‚   â”‚
         â”‚  â”‚ user_sessions  â”‚   â”‚
         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ç’°å¢ƒæ§‹ç¯‰ã¨åˆæœŸè¨­å®š

### å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

```bash
# Node.js (v18ä»¥ä¸Š)
node --version  # v18.x.x ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

# npm ã¾ãŸã¯ yarn
npm --version   # 9.x.x ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèª

# Git
git --version
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ

```bash
# 1. Next.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½œæˆ
npx create-next-app@latest secure-session-system --typescript --app --tailwind

# 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•
cd secure-session-system

# 3. å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm install @mui/material @emotion/react @emotion/styled @mui/icons-material
npm install mongoose mongodb bcryptjs jsonwebtoken
npm install nodemailer @types/nodemailer
npm install dotenv
npm install --save-dev @types/bcryptjs @types/jsonwebtoken
```

### ç’°å¢ƒå¤‰æ•°ã®è¨­å®š (.env.local)

**é‡è¦**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯çµ¶å¯¾ã«GitHubã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãªã„ã“ã¨ï¼

```env
# MongoDBæ¥ç¶šæ–‡å­—åˆ—ï¼ˆMongoDBã®URIã‚’ã‚³ãƒ”ãƒ¼ï¼‰
MONGODB_URI=mongodb+srv://ãƒ¦ãƒ¼ã‚¶ãƒ¼å:ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰@clusterå.mongodb.net/ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å?retryWrites=true&w=majority

# JWTç”¨ã®ç§˜å¯†éµï¼ˆãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’ç”Ÿæˆï¼‰
JWT_SECRET=your-very-long-random-secret-key-here
JWT_ACCESS_SECRET=access-token-secret-key
JWT_REFRESH_SECRET=refresh-token-secret-key

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®è¨­å®š
NODE_ENV=development
NEXTAUTH_URL=http://localhost:3000

# ãƒ¡ãƒ¼ãƒ«é€ä¿¡è¨­å®šï¼ˆSMTPï¼‰
EMAIL_SERVER_HOST=smtp.example.com
EMAIL_SERVER_PORT=587
EMAIL_SERVER_SECURE=false
EMAIL_SERVER_USER=your-email@example.com
EMAIL_SERVER_PASSWORD=your-email-password
EMAIL_FROM="Your App <noreply@example.com>"

# ç®¡ç†è€…èªè¨¼ç”¨ã®ç§˜å¯†ã‚­ãƒ¼
ADMIN_SECRET_KEY=admin-development-secret-key

# ç®¡ç†è€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆé€šçŸ¥ç”¨ï¼‰
ADMIN_EMAIL=admin@example.com
```

---

## 3. MongoDB Atlas ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆã¨ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **MongoDB Atlas ã«ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—**
   - https://www.mongodb.com/cloud/atlas ã«ã‚¢ã‚¯ã‚»ã‚¹
   - ç„¡æ–™ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ

2. **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ**
   ```
   1. "Build a Cluster" ã‚’ã‚¯ãƒªãƒƒã‚¯
   2. "Shared" (ç„¡æ–™) ã‚’é¸æŠ
   3. ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã¨ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚’é¸æŠï¼ˆAWS / Tokyoæ¨å¥¨ï¼‰
   4. ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼åã‚’å…¥åŠ›ï¼ˆä¾‹: Cluster0ï¼‰
   5. "Create Cluster" ã‚’ã‚¯ãƒªãƒƒã‚¯
   ```

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ**
   ```
   1. Security â†’ Database Access
   2. "Add New Database User" ã‚’ã‚¯ãƒªãƒƒã‚¯
   3. èªè¨¼æ–¹æ³•: Password
   4. ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š
   5. Database User Privileges: "Read and write to any database"
   6. "Add User" ã‚’ã‚¯ãƒªãƒƒã‚¯
   ```

4. **IPã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆç™»éŒ²**
   ```
   1. Security â†’ Network Access
   2. "Add IP Address" ã‚’ã‚¯ãƒªãƒƒã‚¯
   3. "Allow Access from Anywhere" ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆé–‹ç™ºæ™‚ã®ã¿ï¼‰
   4. æœ¬ç•ªç’°å¢ƒã§ã¯ç‰¹å®šã®IPã®ã¿è¨±å¯ã™ã‚‹ã“ã¨
   ```

5. **æ¥ç¶šæ–‡å­—åˆ—ã®å–å¾—**
   ```
   1. Clusters â†’ "Connect" ãƒœã‚¿ãƒ³
   2. "Connect your application" ã‚’é¸æŠ
   3. Driver: Node.js, Version: 5.5 or later
   4. æ¥ç¶šæ–‡å­—åˆ—ã‚’ã‚³ãƒ”ãƒ¼
   5. <password>ã‚’å®Ÿéš›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆ
   6. .env.local ã® MONGODB_URI ã«è²¼ã‚Šä»˜ã‘
   ```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ä½œæˆ

MongoDB Atlas ã®ç®¡ç†ç”»é¢ã§ï¼š

1. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä½œæˆ**
   ```
   1. Browse Collections ã‚’ã‚¯ãƒªãƒƒã‚¯
   2. Create Database ã‚’ã‚¯ãƒªãƒƒã‚¯
   3. Database name: embrocal
   4. Collection name: users
   5. Create ã‚’ã‚¯ãƒªãƒƒã‚¯
   ```

2. **å¿…è¦ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³**
   ```
   - users          # ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
   - posts          # æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿
   - reports        # é€šå ±ãƒ‡ãƒ¼ã‚¿
   - audit_logs     # ç›£æŸ»ãƒ­ã‚°
   - user_sessions  # ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±
   - comments       # ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿
   ```

---

## 4. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã®è©³ç´°

### å®Œå…¨ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
secure-session-system/
â”œâ”€â”€ app/                              # Next.js App Router
â”‚   â”œâ”€â”€ layout.tsx                    # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”œâ”€â”€ page.tsx                      # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ globals.css                   # ã‚°ãƒ­ãƒ¼ãƒãƒ«CSS
â”‚   â”‚
â”‚   â”œâ”€â”€ admin/                        # ç®¡ç†ç”»é¢
â”‚   â”‚   â”œâ”€â”€ layout.tsx                # ç®¡ç†ç”»é¢ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â”œâ”€â”€ dashboard/                # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ users/                    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ [id]/                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ new/                  # æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ posts/                    # æŠ•ç¨¿ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # æŠ•ç¨¿ä¸€è¦§
â”‚   â”‚   â”‚   â””â”€â”€ [id]/                 # æŠ•ç¨¿è©³ç´°
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â”œâ”€â”€ reports/                  # é€šå ±ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx              # é€šå ±ä¸€è¦§
â”‚   â”‚   â”‚   â””â”€â”€ [id]/                 # é€šå ±è©³ç´°
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ sessions/                 # ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚
â”‚   â””â”€â”€ api/                          # API Routes
â”‚       â””â”€â”€ admin/
â”‚           â”œâ”€â”€ users/
â”‚           â”‚   â”œâ”€â”€ route.ts          # GET/POST/PUT/DELETE
â”‚           â”‚   â””â”€â”€ [id]/
â”‚           â”‚       â””â”€â”€ route.ts
â”‚           â”œâ”€â”€ posts/
â”‚           â”‚   â”œâ”€â”€ route.ts
â”‚           â”‚   â””â”€â”€ [id]/
â”‚           â”‚       â””â”€â”€ route.ts
â”‚           â””â”€â”€ reports/
â”‚               â”œâ”€â”€ route.ts
â”‚               â””â”€â”€ [id]/
â”‚                   â””â”€â”€ route.ts
â”‚
â”œâ”€â”€ lib/                              # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
â”‚   â”œâ”€â”€ db.ts                         # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”‚   â”œâ”€â”€ auth.ts                       # èªè¨¼é–¢é€£
â”‚   â””â”€â”€ email.ts                      # ãƒ¡ãƒ¼ãƒ«é€ä¿¡
â”‚
â”œâ”€â”€ models/                           # Mongooseãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ User.js                       # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«
â”‚   â”œâ”€â”€ Post.js                       # æŠ•ç¨¿ãƒ¢ãƒ‡ãƒ«
â”‚   â””â”€â”€ Report.js                     # é€šå ±ãƒ¢ãƒ‡ãƒ«
â”‚
â”œâ”€â”€ components/                       # å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ Navigation.tsx                # ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ UserCard.tsx                  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚«ãƒ¼ãƒ‰
â”‚   â””â”€â”€ StatusChip.tsx                # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
â”‚
â”œâ”€â”€ scripts/                          # ãƒ‡ãƒ¼ã‚¿ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ create-test-users.js         # ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
â”‚   â”œâ”€â”€ create-test-posts.js         # ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ä½œæˆ
â”‚   â””â”€â”€ create-test-reports.js       # ãƒ†ã‚¹ãƒˆé€šå ±ä½œæˆ
â”‚
â”œâ”€â”€ public/                           # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â””â”€â”€ images/
â”‚
â”œâ”€â”€ .env.local                        # ç’°å¢ƒå¤‰æ•°ï¼ˆGitignoreå¯¾è±¡ï¼‰
â”œâ”€â”€ .gitignore                        # Gité™¤å¤–è¨­å®š
â”œâ”€â”€ package.json                      # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®š
â”œâ”€â”€ tsconfig.json                     # TypeScriptè¨­å®š
â””â”€â”€ next.config.js                    # Next.jsè¨­å®š
```

---

## 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆã¨ã‚¹ã‚­ãƒ¼ãƒ

### Users ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439011"),
  email: "user@example.com",            // å¿…é ˆã€ãƒ¦ãƒ‹ãƒ¼ã‚¯
  name: "å±±ç”°å¤ªéƒ",                      // è¡¨ç¤ºå
  password: "$2a$10$...",               // bcryptã§ãƒãƒƒã‚·ãƒ¥åŒ–
  role: "user",                          // user | moderator | admin
  status: "active",                      // active | suspended | banned | deleted
  warningCount: 0,                       // è­¦å‘Šå›æ•°
  createdAt: ISODate("2024-03-20T10:00:00Z"),
  updatedAt: ISODate("2024-03-20T10:00:00Z"),
  lastLoginAt: ISODate("2024-03-20T10:00:00Z"),
  emailVerified: true,                   // ãƒ¡ãƒ¼ãƒ«èªè¨¼æ¸ˆã¿
  profilePicture: "https://...",         // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒURL
  bio: "è‡ªå·±ç´¹ä»‹æ–‡",                     // è‡ªå·±ç´¹ä»‹
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
  // - email: unique index
  // - createdAt: -1 (é™é †)
  // - status: 1
}
```

### Posts ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439012"),
  authorId: "507f1f77bcf86cd799439011",   // ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
  authorName: "å±±ç”°å¤ªéƒ",
  authorEmail: "user@example.com",
  author: ObjectId("507f1f77bcf86cd799439011"), // Userå‚ç…§
  content: "æŠ•ç¨¿å†…å®¹...",                  // æŠ•ç¨¿æœ¬æ–‡
  likes: ["userId1", "userId2"],          // ã„ã„ã­ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼IDé…åˆ—
  comments: [                              // ã‚³ãƒ¡ãƒ³ãƒˆé…åˆ—
    {
      _id: ObjectId(),
      authorId: "userId",
      content: "ã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹",
      createdAt: ISODate()
    }
  ],
  isDeleted: false,                        // è«–ç†å‰Šé™¤ãƒ•ãƒ©ã‚°
  isHidden: false,                         // éè¡¨ç¤ºãƒ•ãƒ©ã‚°
  reported: false,                         // é€šå ±ã•ã‚Œã¦ã„ã‚‹ã‹
  reportCount: 0,                          // é€šå ±å›æ•°
  createdAt: ISODate("2024-03-20T10:00:00Z"),
  updatedAt: ISODate("2024-03-20T10:00:00Z"),
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
  // - authorId: 1
  // - createdAt: -1
  // - isDeleted: 1, isHidden: 1
}
```

### Reports ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439013"),
  
  // é€šå ±ã®åŸºæœ¬æƒ…å ±
  reportType: "post",                     // post | user | comment
  targetId: ObjectId("..."),              // é€šå ±å¯¾è±¡ã®ID
  targetUserId: "userId",                 // å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ID
  targetContent: "é•åå†…å®¹...",           // å¯¾è±¡ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
  
  // é€šå ±è€…æƒ…å ±
  reporterId: ObjectId("..."),            // é€šå ±è€…ã®ID
  reporterEmail: "reporter@example.com",
  reporterName: "é€šå ±è€…å",
  
  // é€šå ±ç†ç”±
  reason: "spam",                         // spam | harassment | inappropriate_content | hate_speech | violence | misinformation | copyright | other
  reasonDetails: "è©³ç´°ãªç†ç”±...",
  
  // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
  status: "pending",                      // pending | reviewing | approved | rejected | resolved
  priority: "medium",                      // low | medium | high | critical
  
  // å‡¦ç†æƒ…å ±
  assignedTo: ObjectId("..."),            // æ‹…å½“è€…ID
  assignedAt: ISODate(),
  reviewedBy: ObjectId("..."),            // ãƒ¬ãƒ“ãƒ¥ãƒ¼è€…ID
  reviewedAt: ISODate(),
  
  resolution: {
    action: "warning_issued",             // warning_issued | content_removed | user_suspended | user_banned | no_action | false_report
    notes: "å‡¦ç†ãƒ¡ãƒ¢",
    resolvedAt: ISODate()
  },
  
  // è¿½åŠ æƒ…å ±
  evidence: ["url1", "url2"],             // è¨¼æ‹ ã®URL
  previousReports: [                      // éå»ã®é€šå ±
    {
      reportId: ObjectId(),
      createdAt: ISODate()
    }
  ],
  
  internalNotes: [                        // å†…éƒ¨ãƒ¡ãƒ¢
    {
      note: "ãƒ¡ãƒ¢å†…å®¹",
      addedBy: ObjectId(),
      addedAt: ISODate()
    }
  ],
  
  // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿
  ipAddress: "192.168.1.1",
  userAgent: "Mozilla/5.0...",
  createdAt: ISODate("2024-03-20T10:00:00Z"),
  updatedAt: ISODate("2024-03-20T10:00:00Z"),
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
  // - status: 1, priority: -1, createdAt: -1
  // - targetId: 1
  // - reporterId: 1
}
```

### Audit_logs ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439014"),
  timestamp: ISODate("2024-03-20T10:00:00Z"),
  action: "ROLE_CHANGE",                  // ROLE_CHANGE | WARNING | SUSPEND | REACTIVATE | DELETE_USER | etc.
  adminId: "adminUserId",                 // å®Ÿè¡Œã—ãŸç®¡ç†è€…
  targetUserId: "targetUserId",           // å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
  targetUserEmail: "user@example.com",
  details: {                              // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã®è©³ç´°
    oldRole: "user",
    newRole: "moderator",
    reason: "æ˜‡æ ¼ç†ç”±"
  },
  ipAddress: "192.168.1.1",
  userAgent: "Mozilla/5.0...",
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
  // - timestamp: -1
  // - adminId: 1
  // - targetUserId: 1
}
```

### User_sessions ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³

```javascript
{
  _id: ObjectId("507f1f77bcf86cd799439015"),
  sessionId: "unique-session-id",
  userId: "userId",
  token: "jwt-token",
  createdAt: ISODate("2024-03-20T10:00:00Z"),
  lastActivity: ISODate("2024-03-20T10:30:00Z"),
  expiresAt: ISODate("2024-03-21T10:00:00Z"),
  ipAddress: "192.168.1.1",
  userAgent: "Mozilla/5.0...",
  isActive: true,
  deviceType: "desktop",                  // desktop | mobile | tablet
  location: "Tokyo, Japan",
  
  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹è¨­å®š
  // - userId: 1
  // - sessionId: 1
  // - expiresAt: 1
}
```

---

## 6. èªè¨¼ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã®å®Ÿè£… (/lib/db.ts)

```typescript
import mongoose from 'mongoose';

const MONGODB_URI = process.env.MONGODB_URI!;

if (!MONGODB_URI) {
  throw new Error('Please define the MONGODB_URI environment variable');
}

// ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆé–‹ç™ºç’°å¢ƒã§ã®Hot Reloadå¯¾ç­–ï¼‰
let cached = (global as any).mongoose;

if (!cached) {
  cached = (global as any).mongoose = { conn: null, promise: null };
}

export async function connectDatabase() {
  if (cached.conn) {
    return cached.conn;
  }

  if (!cached.promise) {
    const opts = {
      bufferCommands: false,
    };

    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {
      return mongoose;
    });
  }

  try {
    cached.conn = await cached.promise;
  } catch (e) {
    cached.promise = null;
    throw e;
  }

  return cached.conn;
}
```

### ç®¡ç†è€…èªè¨¼ã®å®Ÿè£…

ã™ã¹ã¦ã®APIãƒ«ãƒ¼ãƒˆã§ç®¡ç†è€…æ¨©é™ã‚’ç¢ºèªï¼š

```typescript
// API Route ã®ä¾‹
export async function GET(request: NextRequest) {
  // ç®¡ç†è€…æ¨©é™ã®ç¢ºèª
  const isAdmin = request.headers.get('x-admin-secret') === process.env.ADMIN_SECRET_KEY;
  if (!isAdmin) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // å‡¦ç†ã‚’ç¶šè¡Œ...
}
```

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®APIã‚³ãƒ¼ãƒ«ï¼š

```typescript
const response = await fetch('/api/admin/users', {
  headers: {
    'x-admin-secret': process.env.NEXT_PUBLIC_ADMIN_SECRET_KEY || 'admin-development-secret-key'
  }
});
```

### ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–

```javascript
const bcrypt = require('bcryptjs');

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
const hashedPassword = await bcrypt.hash(plainPassword, 10);

// ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¤œè¨¼
const isValid = await bcrypt.compare(plainPassword, hashedPassword);
```

---

## 7. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ç”»é¢ (/app/admin/users/page.tsx)

```typescript
'use client';

import { useState, useEffect } from 'react';
import {
  Box,
  Paper,
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow,
  TablePagination,
  Typography,
  Chip,
  IconButton,
  Button,
  TextField,
  Select,
  MenuItem,
  FormControl,
  InputLabel,
  Checkbox
} from '@mui/material';
import { useRouter } from 'next/navigation';

interface User {
  _id: string;
  email: string;
  name: string;
  role: string;
  status: string;
  warningCount: number;
  createdAt: string;
  lastLoginAt: string | null;
}

export default function UsersPage() {
  const router = useRouter();
  const [users, setUsers] = useState<User[]>([]);
  const [loading, setLoading] = useState(true);
  const [page, setPage] = useState(0);
  const [rowsPerPage, setRowsPerPage] = useState(50);
  const [totalUsers, setTotalUsers] = useState(0);
  
  // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
  const [searchTerm, setSearchTerm] = useState('');
  const [roleFilter, setRoleFilter] = useState('');
  const [statusFilter, setStatusFilter] = useState('');
  
  // é¸æŠ
  const [selectedUsers, setSelectedUsers] = useState<string[]>([]);

  useEffect(() => {
    fetchUsers();
  }, [page, rowsPerPage, searchTerm, roleFilter, statusFilter]);

  const fetchUsers = async () => {
    setLoading(true);
    try {
      const params = new URLSearchParams({
        page: (page + 1).toString(),
        limit: rowsPerPage.toString(),
        ...(searchTerm && { search: searchTerm }),
        ...(roleFilter && { role: roleFilter }),
        ...(statusFilter && { status: statusFilter })
      });

      const response = await fetch(`/api/admin/users?${params}`, {
        headers: {
          'x-admin-secret': process.env.NEXT_PUBLIC_ADMIN_SECRET_KEY || 'admin-development-secret-key'
        }
      });

      if (response.ok) {
        const data = await response.json();
        setUsers(data.users);
        setTotalUsers(data.total);
      }
    } catch (error) {
      console.error('Error fetching users:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleUserAction = async (userId: string, action: string) => {
    try {
      const response = await fetch(`/api/admin/users/${userId}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'x-admin-secret': process.env.NEXT_PUBLIC_ADMIN_SECRET_KEY || 'admin-development-secret-key'
        },
        body: JSON.stringify({ action })
      });

      if (response.ok) {
        fetchUsers();
      }
    } catch (error) {
      console.error('Error updating user:', error);
    }
  };

  const getStatusColor = (status: string) => {
    switch (status) {
      case 'active': return 'success';
      case 'suspended': return 'warning';
      case 'banned': return 'error';
      case 'deleted': return 'default';
      default: return 'default';
    }
  };

  return (
    <Box sx={{ p: 3 }}>
      <Typography variant="h4" gutterBottom>
        ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†
      </Typography>

      {/* ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ */}
      <Paper sx={{ p: 2, mb: 3 }}>
        <Box sx={{ display: 'flex', gap: 2, flexWrap: 'wrap' }}>
          <TextField
            size="small"
            label="æ¤œç´¢"
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            sx={{ minWidth: 200 }}
          />
          
          <FormControl size="small" sx={{ minWidth: 120 }}>
            <InputLabel>æ¨©é™</InputLabel>
            <Select
              value={roleFilter}
              label="æ¨©é™"
              onChange={(e) => setRoleFilter(e.target.value)}
            >
              <MenuItem value="">ã™ã¹ã¦</MenuItem>
              <MenuItem value="admin">ç®¡ç†è€…</MenuItem>
              <MenuItem value="moderator">ãƒ¢ãƒ‡ãƒ¬ãƒ¼ã‚¿ãƒ¼</MenuItem>
              <MenuItem value="user">ãƒ¦ãƒ¼ã‚¶ãƒ¼</MenuItem>
            </Select>
          </FormControl>

          <FormControl size="small" sx={{ minWidth: 120 }}>
            <InputLabel>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</InputLabel>
            <Select
              value={statusFilter}
              label="ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹"
              onChange={(e) => setStatusFilter(e.target.value)}
            >
              <MenuItem value="">ã™ã¹ã¦</MenuItem>
              <MenuItem value="active">ã‚¢ã‚¯ãƒ†ã‚£ãƒ–</MenuItem>
              <MenuItem value="suspended">åœæ­¢ä¸­</MenuItem>
              <MenuItem value="banned">BAN</MenuItem>
            </Select>
          </FormControl>

          <Button
            variant="contained"
            onClick={() => router.push('/admin/users/new')}
          >
            æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
          </Button>
        </Box>
      </Paper>

      {/* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ« */}
      <TableContainer component={Paper}>
        <Table>
          <TableHead>
            <TableRow>
              <TableCell padding="checkbox">
                <Checkbox
                  checked={selectedUsers.length === users.length}
                  onChange={(e) => {
                    if (e.target.checked) {
                      setSelectedUsers(users.map(u => u._id));
                    } else {
                      setSelectedUsers([]);
                    }
                  }}
                />
              </TableCell>
              <TableCell>åå‰</TableCell>
              <TableCell>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</TableCell>
              <TableCell>æ¨©é™</TableCell>
              <TableCell>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</TableCell>
              <TableCell>è­¦å‘Š</TableCell>
              <TableCell>ä½œæˆæ—¥</TableCell>
              <TableCell>æœ€çµ‚ãƒ­ã‚°ã‚¤ãƒ³</TableCell>
              <TableCell align="center">ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</TableCell>
            </TableRow>
          </TableHead>
          <TableBody>
            {users.map((user) => (
              <TableRow key={user._id}>
                <TableCell padding="checkbox">
                  <Checkbox
                    checked={selectedUsers.includes(user._id)}
                    onChange={(e) => {
                      if (e.target.checked) {
                        setSelectedUsers([...selectedUsers, user._id]);
                      } else {
                        setSelectedUsers(selectedUsers.filter(id => id !== user._id));
                      }
                    }}
                  />
                </TableCell>
                <TableCell>{user.name || 'Unknown'}</TableCell>
                <TableCell>{user.email}</TableCell>
                <TableCell>
                  <Chip
                    label={user.role}
                    size="small"
                    color={user.role === 'admin' ? 'error' : user.role === 'moderator' ? 'warning' : 'default'}
                  />
                </TableCell>
                <TableCell>
                  <Chip
                    label={user.status}
                    size="small"
                    color={getStatusColor(user.status) as any}
                  />
                </TableCell>
                <TableCell>{user.warningCount || 0}</TableCell>
                <TableCell>
                  {new Date(user.createdAt).toLocaleDateString('ja-JP')}
                </TableCell>
                <TableCell>
                  {user.lastLoginAt 
                    ? new Date(user.lastLoginAt).toLocaleDateString('ja-JP')
                    : '-'
                  }
                </TableCell>
                <TableCell align="center">
                  <Button
                    size="small"
                    onClick={() => router.push(`/admin/users/${user._id}`)}
                  >
                    è©³ç´°
                  </Button>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
        <TablePagination
          component="div"
          count={totalUsers}
          page={page}
          onPageChange={(e, newPage) => setPage(newPage)}
          rowsPerPage={rowsPerPage}
          onRowsPerPageChange={(e) => {
            setRowsPerPage(parseInt(e.target.value, 10));
            setPage(0);
          }}
          rowsPerPageOptions={[25, 50, 100]}
          labelRowsPerPage="è¡¨ç¤ºä»¶æ•°:"
        />
      </TableContainer>
    </Box>
  );
}
```

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API (/app/api/admin/users/route.ts)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { connectDatabase } from '@/lib/db';

// GET: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
export async function GET(request: NextRequest) {
  try {
    // ç®¡ç†è€…æ¨©é™ç¢ºèª
    const isAdmin = request.headers.get('x-admin-secret') === process.env.ADMIN_SECRET_KEY;
    if (!isAdmin) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    await connectDatabase();
    const mongoose = require('mongoose');
    const usersCollection = mongoose.connection.collection('users');

    // ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å–å¾—
    const searchParams = request.nextUrl.searchParams;
    const page = parseInt(searchParams.get('page') || '1');
    const limit = parseInt(searchParams.get('limit') || '50');
    const search = searchParams.get('search') || '';
    const role = searchParams.get('role') || '';
    const status = searchParams.get('status') || '';
    const skip = (page - 1) * limit;

    // ãƒ•ã‚£ãƒ«ã‚¿æ¡ä»¶æ§‹ç¯‰
    const filter: any = {};
    
    if (search) {
      filter.$or = [
        { email: { $regex: search, $options: 'i' } },
        { name: { $regex: search, $options: 'i' } }
      ];
    }
    
    if (role) filter.role = role;
    if (status) filter.status = status;

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‡ãƒ¼ã‚¿å–å¾—
    const users = await usersCollection
      .find(filter)
      .sort({ createdAt: -1 })
      .limit(limit)
      .skip(skip)
      .toArray();

    // ç·ä»¶æ•°å–å¾—
    const total = await usersCollection.countDocuments(filter);

    // ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’æ•´å½¢
    const formattedUsers = users.map(user => ({
      _id: user._id.toString(),
      email: user.email,
      name: user.name || 'Unknown',
      role: user.role || 'user',
      status: user.status || 'active',
      warningCount: user.warningCount || 0,
      createdAt: user.createdAt || new Date(),
      lastLoginAt: user.lastLoginAt || null,
      emailVerified: user.emailVerified || false,
      profilePicture: user.profilePicture || null,
      bio: user.bio || ''
    }));

    return NextResponse.json({
      users: formattedUsers,
      total,
      page,
      limit
    });
  } catch (error) {
    console.error('Error fetching users:', error);
    return NextResponse.json(
      { error: 'Failed to fetch users' },
      { status: 500 }
    );
  }
}

// POST: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
export async function POST(request: NextRequest) {
  try {
    // ç®¡ç†è€…æ¨©é™ç¢ºèª
    const isAdmin = request.headers.get('x-admin-secret') === process.env.ADMIN_SECRET_KEY;
    if (!isAdmin) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }

    const body = await request.json();
    const { email, name, password, role, sendWelcomeEmail } = body;

    // å¿…é ˆé …ç›®ãƒã‚§ãƒƒã‚¯
    if (!email || !password) {
      return NextResponse.json(
        { error: 'Email and password are required' },
        { status: 400 }
      );
    }

    await connectDatabase();
    const mongoose = require('mongoose');
    const bcrypt = require('bcryptjs');
    const usersCollection = mongoose.connection.collection('users');

    // æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒã‚§ãƒƒã‚¯
    const existingUser = await usersCollection.findOne({ email });
    if (existingUser) {
      return NextResponse.json(
        { error: 'User already exists' },
        { status: 400 }
      );
    }

    // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®ãƒãƒƒã‚·ãƒ¥åŒ–
    const hashedPassword = await bcrypt.hash(password, 10);

    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
    const newUser = {
      email,
      name: name || email.split('@')[0],
      password: hashedPassword,
      role: role || 'user',
      status: 'active',
      warningCount: 0,
      createdAt: new Date(),
      updatedAt: new Date(),
      emailVerified: false
    };

    const result = await usersCollection.insertOne(newUser);

    // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
    if (sendWelcomeEmail) {
      try {
        const { sendWelcomeEmail: sendEmail } = await import('@/lib/email');
        await sendEmail(email, newUser.name, password);
      } catch (emailError) {
        console.error('Failed to send welcome email:', emailError);
      }
    }

    // ç›£æŸ»ãƒ­ã‚°è¨˜éŒ²
    const auditLogsCollection = mongoose.connection.collection('audit_logs');
    await auditLogsCollection.insertOne({
      timestamp: new Date(),
      action: 'CREATE_USER',
      adminId: 'admin-user',
      targetUserId: result.insertedId.toString(),
      targetUserEmail: email,
      details: { role, sendWelcomeEmail },
      ipAddress: request.headers.get('x-forwarded-for') || request.headers.get('x-real-ip'),
      userAgent: request.headers.get('user-agent')
    });

    return NextResponse.json({
      success: true,
      message: 'User created successfully',
      userId: result.insertedId.toString()
    });
  } catch (error) {
    console.error('Error creating user:', error);
    return NextResponse.json(
      { error: 'Failed to create user' },
      { status: 500 }
    );
  }
}
```

---

## 8. æŠ•ç¨¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

### æŠ•ç¨¿ä¸€è¦§ç”»é¢ã®é‡è¦ãƒã‚¤ãƒ³ãƒˆ

```typescript
// ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®å®Ÿè£…
const filter: any = {};

// å‰Šé™¤æ¸ˆã¿ã‚’å«ã‚€ã‹ã©ã†ã‹
if (!includeDeleted) {
  filter.isDeleted = { $ne: true };
}

// éè¡¨ç¤ºã‚’å«ã‚€ã‹ã©ã†ã‹
if (!includeHidden) {
  filter.isHidden = { $ne: true };
}

// é€šå ±æ¸ˆã¿ã®ã¿è¡¨ç¤º
if (reportedOnly) {
  filter.reported = true;
}

// æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿å–å¾—æ™‚ã®æ³¨æ„ç‚¹
const posts = await postsCollection
  .find(filter)
  .sort({ createdAt: -1 })  // æ–°ã—ã„é †
  .limit(limit)
  .skip(skip)
  .toArray();

// ã„ã„ã­æ•°ã¨ã‚³ãƒ¡ãƒ³ãƒˆæ•°ã®è¨ˆç®—
const formattedPosts = posts.map(post => ({
  ...post,
  likesCount: post.likes ? post.likes.length : 0,
  commentsCount: post.comments ? post.comments.length : 0
}));
```

---

## 9. é€šå ±ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

### é€šå ±ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨å®Ÿè£…

#### ObjectIdã®æ‰±ã„æ–¹ï¼ˆé‡è¦ï¼ï¼‰

MongoDBã®ObjectIdã‚’æ‰±ã†éš›ã®æ³¨æ„ç‚¹ï¼š

```typescript
const mongoose = require('mongoose');
const ObjectId = mongoose.Types.ObjectId;

// ObjectIdã®ä½œæˆæ–¹æ³•ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ç•°ãªã‚‹ï¼‰
// æ–¹æ³•1: new ObjectIdï¼ˆæ¨å¥¨ï¼‰
const id1 = new ObjectId(stringId);

// æ–¹æ³•2: createFromHexStringï¼ˆå¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
const id2 = ObjectId.createFromHexString(stringId);

// ObjectIdã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆå¿…é ˆï¼ï¼‰
if (!ObjectId.isValid(stringId)) {
  return NextResponse.json(
    { error: 'Invalid ID format' },
    { status: 400 }
  );
}

// try-catchã§å›²ã‚€ï¼ˆé‡è¦ï¼ï¼‰
try {
  const document = await collection.findOne({
    _id: new ObjectId(id)
  });
} catch (error) {
  console.log('Invalid ObjectId:', error);
  // ã‚¨ãƒ©ãƒ¼å‡¦ç†
}
```

#### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®å–å¾—æ–¹æ³•ï¼ˆNext.js 15ã®å¤‰æ›´ç‚¹ï¼‰

```typescript
// Next.js 15ã§ã¯ params ãŒ Promise ã«ãªã£ãŸ
export async function GET(
  request: NextRequest,
  context: { params: Promise<{ id: string }> }  // Promiseå‹ã«æ³¨æ„ï¼
) {
  // params ã‚’ await ã§å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
  const params = await context.params;
  const id = params.id;
  
  // å‡¦ç†ã‚’ç¶šè¡Œ...
}
```

---

## 10. ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã‚·ã‚¹ãƒ†ãƒ 

### Nodemailerã®è¨­å®šã¨å®Ÿè£…

```typescript
const nodemailer = require('nodemailer');

// ãƒˆãƒ©ãƒ³ã‚¹ãƒãƒ¼ã‚¿ãƒ¼ä½œæˆ
export const createEmailTransporter = () => {
  return nodemailer.createTransporter({
    host: process.env.EMAIL_SERVER_HOST,
    port: parseInt(process.env.EMAIL_SERVER_PORT || '587'),
    secure: process.env.EMAIL_SERVER_SECURE === 'true',
    auth: {
      user: process.env.EMAIL_SERVER_USER,
      pass: process.env.EMAIL_SERVER_PASSWORD,
    },
    tls: {
      rejectUnauthorized: false  // è‡ªå·±ç½²åè¨¼æ˜æ›¸ã‚’è¨±å¯
    }
  });
};

// ãƒ¡ãƒ¼ãƒ«é€ä¿¡é–¢æ•°
export const sendEmail = async (
  to: string,
  subject: string,
  html: string,
  text: string
): Promise<boolean> => {
  try {
    const transporter = createEmailTransporter();
    
    const mailOptions = {
      from: process.env.EMAIL_FROM,
      to: to,
      subject: subject,
      html: html,
      text: text
    };
    
    const info = await transporter.sendMail(mailOptions);
    console.log('Email sent:', info.messageId);
    return true;
  } catch (error) {
    console.error('Error sending email:', error);
    return false;
  }
};
```

---

## 11. ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ã¨è§£æ±ºæ–¹æ³•

### 1. MongoDBæ¥ç¶šã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
MongoNetworkError: connect ECONNREFUSED
```

**è§£æ±ºæ–¹æ³•:**
1. MongoDB Atlas ã®Network Access ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç¢ºèª
2. æ¥ç¶šæ–‡å­—åˆ—ã®<password>ã‚’å®Ÿéš›ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«ç½®ãæ›ãˆ
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åãŒæ­£ã—ã„ã‹ç¢ºèª

### 2. ObjectId ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
TypeError: Cannot read properties of undefined (reading 'createFromHexString')
BSONError: Argument passed in must be a string of 12 bytes or a string of 24 hex characters
```

**è§£æ±ºæ–¹æ³•:**
```typescript
// æ­£ã—ã„å®Ÿè£…
const ObjectId = mongoose.Types.ObjectId;

// IDã®å¦¥å½“æ€§ã‚’å¿…ãšãƒã‚§ãƒƒã‚¯
if (!ObjectId.isValid(id)) {
  return { error: 'Invalid ID' };
}

// try-catchã§å›²ã‚€
try {
  const result = await collection.findOne({
    _id: new ObjectId(id)  // new ã‚’ä½¿ç”¨
  });
} catch (error) {
  console.error('ObjectId error:', error);
}
```

### 3. Next.js 15 ã® params ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
TypeError: Cannot destructure property 'id' of 'params' as it is undefined
```

**è§£æ±ºæ–¹æ³•:**
```typescript
// é–“é•ã„
export async function GET(
  request: NextRequest,
  { params }: { params: { id: string } }
) {
  const id = params.id;  // ã‚¨ãƒ©ãƒ¼ï¼
}

// æ­£ã—ã„å®Ÿè£…
export async function GET(
  request: NextRequest,
  context: { params: Promise<{ id: string }> }
) {
  const params = await context.params;  // await ãŒå¿…è¦ï¼
  const id = params.id;
}
```

### 4. MUI DataGrid SSRã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
Runtime TypeError: Cannot read properties of undefined (reading 'size')
```

**è§£æ±ºæ–¹æ³•:**
DataGridã®ä»£ã‚ã‚Šã«ã‚·ãƒ³ãƒ—ãƒ«ãªTableã‚’ä½¿ç”¨ï¼š

```typescript
// âŒ DataGridï¼ˆSSRã§ã‚¨ãƒ©ãƒ¼ï¼‰
import { DataGrid } from '@mui/x-data-grid';

// âœ… Tableï¼ˆSSRå¯¾å¿œï¼‰
import {
  Table,
  TableBody,
  TableCell,
  TableContainer,
  TableHead,
  TableRow
} from '@mui/material';
```

### 5. ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãŒå‹•ä½œã—ãªã„

**å•é¡Œ:**
ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼å¤‰æ›´ã—ã¦ã‚‚çµæœãŒå¤‰ã‚ã‚‰ãªã„

**è§£æ±ºæ–¹æ³•:**
```typescript
// useEffectã®ä¾å­˜é…åˆ—ã«å«ã‚ã‚‹
useEffect(() => {
  fetchData();
}, [page, rowsPerPage, filter1, filter2]);  // ã™ã¹ã¦ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å«ã‚ã‚‹

// URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«æ­£ã—ãè¿½åŠ 
const params = new URLSearchParams({
  page: page.toString(),
  limit: limit.toString(),
  ...(filter1 && { filter1 }),  // æ¡ä»¶ä»˜ãã§è¿½åŠ 
  ...(filter2 && { filter2 })
});
```

### 6. Nodemailer ã‚¨ãƒ©ãƒ¼

**ã‚¨ãƒ©ãƒ¼:**
```
Error: Invalid login: 535 Authentication failed
```

**è§£æ±ºæ–¹æ³•:**
1. SMTPè¨­å®šã‚’ç¢ºèª
2. ã‚¢ãƒ—ãƒªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ï¼ˆGmailã®å ´åˆï¼‰
3. ãƒãƒ¼ãƒˆè¨­å®šã‚’ç¢ºèªï¼ˆ587 for TLS, 465 for SSLï¼‰

---

## 12. é–‹ç™ºæ™‚ã®é‡è¦ãªæ³¨æ„ç‚¹

### 1. ç’°å¢ƒå¤‰æ•°ã®ç®¡ç†

```bash
# .gitignore ã«å¿…ãšå«ã‚ã‚‹
.env.local
.env.production
```

### 2. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®š

ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šã®ãŸã‚ã€å¿…ãšã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¨­å®šï¼š

```javascript
// MongoDB Atlasã®ç®¡ç†ç”»é¢ã§è¨­å®š
// ã¾ãŸã¯Mongooseã‚¹ã‚­ãƒ¼ãƒã§è¨­å®š

// users ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
db.users.createIndex({ email: 1 }, { unique: true });
db.users.createIndex({ createdAt: -1 });
db.users.createIndex({ status: 1 });

// posts ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
db.posts.createIndex({ authorId: 1 });
db.posts.createIndex({ createdAt: -1 });
db.posts.createIndex({ isDeleted: 1, isHidden: 1 });

// reports ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³
db.reports.createIndex({ status: 1, priority: -1, createdAt: -1 });
db.reports.createIndex({ targetId: 1 });
db.reports.createIndex({ reporterId: 1 });
```

### 3. TypeScriptã®å‹å®šç¾©

å¿…ãšå‹ã‚’å®šç¾©ã—ã¦ã‹ã‚‰å®Ÿè£…ï¼š

```typescript
// ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®šç¾©
interface User {
  _id: string;
  email: string;
  name: string;
  role: 'admin' | 'moderator' | 'user';
  status: 'active' | 'suspended' | 'banned' | 'deleted';
  warningCount: number;
  createdAt: Date;
  updatedAt: Date;
}

// APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å‹
interface ApiResponse<T> {
  success: boolean;
  data?: T;
  error?: string;
  message?: string;
}
```

### 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å¾¹åº•

ã™ã¹ã¦ã®éåŒæœŸå‡¦ç†ã§try-catchã‚’ä½¿ç”¨ï¼š

```typescript
export async function handler(request: NextRequest) {
  try {
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
    await connectDatabase();
    
    // å‡¦ç†
    const result = await someAsyncOperation();
    
    // æˆåŠŸãƒ¬ã‚¹ãƒãƒ³ã‚¹
    return NextResponse.json({
      success: true,
      data: result
    });
    
  } catch (error) {
    // ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°
    console.error('Error in handler:', error);
    
    // ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    return NextResponse.json(
      {
        success: false,
        error: error.message || 'Internal server error'
      },
      { status: 500 }
    );
  }
}
```

### 5. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®åˆ†å‰²

å¤§ããªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯å¿…ãšåˆ†å‰²ï¼š

```typescript
// âŒ 1ã¤ã®å·¨å¤§ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
export default function HugePage() {
  // 1000è¡Œã®ã‚³ãƒ¼ãƒ‰...
}

// âœ… æ©Ÿèƒ½ã”ã¨ã«åˆ†å‰²
export default function Page() {
  return (
    <>
      <Header />
      <Filters onFilterChange={handleFilterChange} />
      <DataTable data={data} />
      <Pagination />
    </>
  );
}
```

### 6. ãƒ‡ãƒãƒƒã‚°ã®ã‚³ãƒ„

```typescript
// é–‹ç™ºæ™‚ã®ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°
if (process.env.NODE_ENV === 'development') {
  console.log('Debug data:', {
    filter,
    params,
    result
  });
}

// MongoDBã‚¯ã‚¨ãƒªã®ãƒ­ã‚°
mongoose.set('debug', true);  // ã™ã¹ã¦ã®ã‚¯ã‚¨ãƒªã‚’ãƒ­ã‚°ã«å‡ºåŠ›
```

### 7. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

```typescript
// âŒ N+1å•é¡Œ
const posts = await postsCollection.find().toArray();
for (const post of posts) {
  const author = await usersCollection.findOne({ _id: post.authorId });
  post.authorDetails = author;
}

// âœ… é›†ç´„ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ä½¿ç”¨
const posts = await postsCollection.aggregate([
  {
    $lookup: {
      from: 'users',
      localField: 'authorId',
      foreignField: '_id',
      as: 'authorDetails'
    }
  }
]).toArray();
```

---

## ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ

### ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ–¹æ³•

```bash
# ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
node scripts/create-test-users.js

# ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ä½œæˆ
node scripts/create-test-posts.js

# ãƒ†ã‚¹ãƒˆé€šå ±ä½œæˆ
node scripts/create-test-reports.js

# ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¦å†ä½œæˆ
node scripts/create-test-reports.js --clear
```

---

## æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

### Vercelã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Vercel CLIã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i -g vercel

# ãƒ‡ãƒ—ãƒ­ã‚¤
vercel

# ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
# Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§è¨­å®šã™ã‚‹ã‹ã€CLIã§è¨­å®š
vercel env add MONGODB_URI
vercel env add JWT_SECRET
# ... ä»–ã®ç’°å¢ƒå¤‰æ•°ã‚‚åŒæ§˜ã«
```

### æœ¬ç•ªç’°å¢ƒã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

- [ ] ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] MongoDB Atlas ã®IPãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] HTTPSãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ç›£è¦–ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Rate limitingãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

---

## ã¾ã¨ã‚

ã“ã®ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦å®Ÿè£…ã™ã‚Œã°ã€ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹SNSç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ãŒæ§‹ç¯‰ã§ãã¾ã™ã€‚

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **MongoDB ObjectId** ã®æ‰±ã„ã«æ³¨æ„ï¼ˆå¿…ãšvalidãƒã‚§ãƒƒã‚¯ï¼‰
2. **Next.js 15** ã® params ã¯ Promiseï¼ˆå¿…ãšawaitï¼‰
3. **ç’°å¢ƒå¤‰æ•°** ã¯å¿…ãšè¨­å®šï¼ˆç‰¹ã«MONGODB_URIï¼‰
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** ã¯å¿…ãštry-catch
5. **å‹å®šç¾©** ã‚’æœ€åˆã«ä½œæˆã—ã¦ã‹ã‚‰å®Ÿè£…
6. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹** ã‚’è¨­å®šã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
7. **MUI DataGrid** ã¯ä½¿ã‚ãšTableã‚’ä½¿ç”¨ï¼ˆSSRå¯¾å¿œï¼‰

### å›°ã£ãŸã¨ãã¯

1. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ­£ç¢ºã«èª­ã‚€
2. console.logã§ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«ã‚’ç¢ºèª
3. MongoDB Atlasã®ç®¡ç†ç”»é¢ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèª
4. ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¿ãƒ–ã‚’ç¢ºèª
5. ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã‚’ç¢ºèªï¼ˆnpm run devã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ãªãŒã‚‰é–‹ç™ºã‚’é€²ã‚ã‚Œã°ã€å¿…ãšå®Œæˆã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ï¼