# メール設定ガイド

## テストメール送信のセットアップ

### 1. Gmail を使用する場合（推奨）

#### 手順：

1. **Googleアカウントの2段階認証を有効化**
   - https://myaccount.google.com/security にアクセス
   - 「2段階認証」を有効化

2. **アプリパスワードの生成**
   - https://myaccount.google.com/apppasswords にアクセス
   - 「アプリを選択」→「その他」を選択
   - 「Secure Session System」など任意の名前を入力
   - 生成されたパスワードをコピー

3. **システム設定で設定**
   ```
   SMTPホスト: smtp.gmail.com
   SMTPポート: 587
   SMTPユーザー名: あなたのGmailアドレス
   SMTPパスワード: 生成したアプリパスワード
   セキュア接続: OFF（TLSは自動）
   送信者メールアドレス: あなたのGmailアドレス
   送信者名: 任意の名前
   ```

### 2. Mailtrap を使用する場合（開発環境推奨）

#### 手順：

1. **Mailtrapアカウントの作成**
   - https://mailtrap.io にアクセス
   - 無料アカウントを作成

2. **Inboxの設定を取得**
   - ダッシュボードから「Inboxes」を選択
   - 「SMTP Settings」を確認

3. **システム設定で設定**
   ```
   SMTPホスト: sandbox.smtp.mailtrap.io
   SMTPポート: 2525
   SMTPユーザー名: Mailtrapで表示されるユーザー名
   SMTPパスワード: Mailtrapで表示されるパスワード
   セキュア接続: OFF
   送信者メールアドレス: 任意のアドレス（例: test@example.com）
   送信者名: 任意の名前
   ```

### 3. 環境変数での設定（.env.local）

セキュリティのため、パスワードは環境変数に設定することを推奨：

```bash
# .env.local
SMTP_PASSWORD=your_app_password_here
```

### トラブルシューティング

#### エラー: "Authentication failed"
- アプリパスワードが正しいか確認
- Gmailの場合、2段階認証が有効か確認
- ユーザー名がメールアドレス全体であることを確認

#### エラー: "Connection timeout"
- ファイアウォールがSMTPポートをブロックしていないか確認
- 企業ネットワークの場合、プロキシ設定を確認

#### エラー: "Self signed certificate"
- セキュア接続の設定を確認
- ポート587の場合はTLS、ポート465の場合はSSLを使用

### テスト手順

1. システム設定画面を開く: http://localhost:3001/admin/settings
2. 「メール設定」タブを選択
3. SMTP設定を入力
4. 「設定を保存」をクリック
5. テストメールアドレスを入力
6. 「テスト送信」をクリック

成功すると「テストメールを送信しました」と表示されます。

### セキュリティ注意事項

- **本番環境では必ず環境変数を使用**してパスワードを管理
- アプリパスワードは定期的に更新
- 不要になったアプリパスワードは削除
- SMTPパスワードはデータベースに暗号化して保存される

## サポート

問題が解決しない場合は、以下を確認：
- ネットワーク接続
- メールサーバーのステータス
- 認証情報の正確性