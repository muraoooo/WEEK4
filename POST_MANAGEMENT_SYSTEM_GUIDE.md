# 投稿管理システム 完全ガイド

## 📋 目次
1. [システム概要](#システム概要)
2. [ディレクトリ構造](#ディレクトリ構造)
3. [各ファイルの役割](#各ファイルの役割)
4. [機能の詳細説明](#機能の詳細説明)
5. [使い方](#使い方)
6. [技術的な仕組み](#技術的な仕組み)

---

## 🎯 システム概要

### このシステムは何をするものか？
投稿管理システムは、SNSやフォーラムサイトでユーザーが投稿したコンテンツを管理者が効率的に管理・監視するためのツールです。

### 主な機能
- 📝 **投稿の一覧表示**: すべての投稿を表形式で見やすく表示
- 🤖 **AI自動チェック**: 不適切な内容を自動で検出
- ⚠️ **通報管理**: ユーザーからの通報を管理
- 🔍 **フィルタリング**: 条件を指定して投稿を絞り込み
- ⚡ **一括操作**: 複数の投稿をまとめて処理
- 📊 **履歴記録**: すべての操作を記録

---

## 📁 ディレクトリ構造

```
secure-session-system/
│
├── app/                        # アプリケーションの主要部分
│   ├── admin/                  # 管理者用の画面
│   │   └── posts/              # 投稿管理関連
│   │       ├── page.tsx        # 投稿一覧画面
│   │       └── [id]/           # 個別投稿の詳細
│   │           └── page.tsx    # 投稿詳細画面
│   │
│   └── api/                    # サーバー側の処理
│       └── admin/
│           ├── posts/          # 投稿データの処理
│           │   ├── route.ts    # 基本的な投稿操作
│           │   ├── [id]/       
│           │   │   └── route.ts # 個別投稿の操作
│           │   ├── bulk/       
│           │   │   └── route.ts # 一括操作
│           │   └── export/     
│           │       └── route.ts # データ出力
│           │
│           └── moderation/     # AI判定
│               └── route.ts    # AIモデレーション処理
│
├── components/                 # 再利用可能な部品
│   └── admin/
│       └── PostModeration.tsx  # AIモデレーション画面
│
└── __tests__/                  # テストコード
    └── admin/
        └── posts.test.ts       # 投稿管理のテスト
```

---

## 📄 各ファイルの役割

### 画面ファイル（ユーザーが見る部分）

#### 1. `app/admin/posts/page.tsx` - 投稿一覧画面
**役割**: 管理者が全ての投稿を一覧で確認する画面

**できること**:
- 投稿の一覧表示
- 検索とフィルタリング
- 一括選択と操作
- CSVファイルへのエクスポート

**画面イメージ**:
```
┌─────────────────────────────────────────┐
│ 投稿管理                    [更新] [CSV] │
├─────────────────────────────────────────┤
│ 🔍 検索 [      ] ▼ステータス ▼期間     │
├─────────────────────────────────────────┤
│ □ | 投稿者 | 内容 | いいね | 通報 | ... │
│ □ | 田中   | ... | 10     | 0    | ... │
│ □ | 鈴木   | ... | 5      | 3    | ... │
└─────────────────────────────────────────┘
```

#### 2. `app/admin/posts/[id]/page.tsx` - 投稿詳細画面
**役割**: 個別の投稿の詳細情報を表示

**できること**:
- 投稿内容の全文表示
- コメント一覧の確認
- 通報履歴の確認
- 個別アクション（削除、非表示など）

#### 3. `components/admin/PostModeration.tsx` - AI判定結果画面
**役割**: AIが分析した結果を表示するポップアップ画面

**画面イメージ**:
```
┌──── AIモデレーション分析 ────┐
│ リスクスコア: ████████ 75%    │
│                               │
│ 検出された問題:               │
│ ⚠️ 暴力的な表現              │
│ ⚠️ 不適切な言葉              │
│                               │
│ 推奨アクション:               │
│ ✓ この投稿を非表示にする     │
│                               │
│ [閉じる] [非表示] [削除]      │
└───────────────────────────────┘
```

### サーバー処理ファイル（裏側の処理）

#### 1. `app/api/admin/posts/route.ts` - 基本的な投稿操作
**役割**: 投稿データの取得・更新・削除を処理

**処理内容**:
- データベースから投稿を取得
- フィルタリング条件の適用
- 投稿の状態変更（削除、非表示など）

#### 2. `app/api/admin/moderation/route.ts` - AI判定処理
**役割**: 投稿内容を分析して危険度を判定

**判定する内容**:
- 暴力的な表現（危険度: 高）
- 嫌がらせ（危険度: 中）
- スパム（危険度: 中）
- 不適切な内容（危険度: 高）

**判定の仕組み**:
```
投稿内容「クリックして無料で購入！」
    ↓
キーワード検出: "クリック", "無料", "購入"
    ↓
スパムスコア: 80%
    ↓
結果: 高リスクと判定
```

#### 3. `app/api/admin/posts/bulk/route.ts` - 一括操作処理
**役割**: 複数の投稿をまとめて処理

**できる操作**:
- 選択した投稿を一括削除
- 選択した投稿を一括非表示
- カテゴリの一括変更

#### 4. `app/api/admin/posts/export/route.ts` - データ出力処理
**役割**: 投稿データをCSVファイルとして出力

**出力される情報**:
- 投稿者名とメールアドレス
- 投稿内容
- いいね数、コメント数
- 通報数
- ステータス（公開/非表示/削除済み）

---

## 🎮 機能の詳細説明

### 1. フィルタリング機能
投稿を条件で絞り込んで表示する機能です。

**使える条件**:
- **ステータス**: アクティブ、非表示、削除済み
- **期間**: 今日、今週、今月
- **カテゴリ**: 一般、ニュース、議論、質問
- **通報**: 通報あり、高リスク、解決済み

**例**: 「今月投稿された、通報がある投稿だけを表示」

### 2. AIモデレーション（自動判定）
投稿内容を自動で分析し、問題がないかチェックします。

**判定プロセス**:
1. 投稿内容をスキャン
2. 危険なキーワードを検出
3. リスクスコアを計算（0〜100%）
4. 推奨アクションを提案

**リスクレベル**:
- 🟢 **低リスク（0-40%）**: 問題なし
- 🟡 **中リスク（40-60%）**: 要確認
- 🔴 **高リスク（60-100%）**: 即対応推奨

### 3. 一括操作機能
複数の投稿を選択して、まとめて処理できます。

**操作の流れ**:
1. チェックボックスで投稿を選択
2. アクションボタンをクリック
3. 確認ダイアログで「実行」
4. 選択した全投稿に処理が適用

### 4. 通報管理
ユーザーからの通報を管理します。

**通報のステータス**:
- 📌 **未対応**: まだ確認していない
- 👁️ **確認済み**: 管理者が確認した
- ✅ **解決済み**: 対応が完了した

---

## 📖 使い方

### 基本的な操作手順

#### 1. 投稿を探す
```
1. 検索ボックスに キーワードを入力
2. フィルターで条件を選択
3. 「更新」ボタンをクリック
```

#### 2. 問題のある投稿を処理する
```
1. 投稿の右側の「AI」ボタンをクリック
2. AIの判定結果を確認
3. 推奨アクションに従って処理
```

#### 3. 複数の投稿をまとめて処理
```
1. 処理したい投稿のチェックボックスを選択
2. 「一括削除」や「一括非表示」ボタンをクリック
3. 確認画面で「実行」をクリック
```

#### 4. データをエクスポート
```
1. フィルターで必要なデータを絞り込み
2. 「エクスポート」ボタンをクリック
3. CSVファイルがダウンロードされる
```

---

## ⚙️ 技術的な仕組み

### データの流れ
```
ユーザーの操作
    ↓
画面（page.tsx）
    ↓
API（route.ts）
    ↓
データベース（MongoDB）
    ↓
結果を画面に表示
```

### AIモデレーションの仕組み

#### キーワードベースの判定
システムは危険なキーワードのリストを持っており、投稿内容と照合します。

**例**:
```javascript
危険キーワード = ["暴力", "攻撃", "死ね"]
投稿内容 = "この商品は攻撃的なデザインです"
    ↓
"攻撃"が検出される
    ↓
暴力スコア: 30%
```

#### スコアの計算方法
```
総合スコア = (最大カテゴリスコア × 0.7) + (平均スコア × 0.3)

例:
暴力: 60%、スパム: 20%、その他: 10%
最大: 60%、平均: 30%
総合スコア = (60 × 0.7) + (30 × 0.3) = 42 + 9 = 51%
```

### セキュリティ対策

1. **権限確認**: 管理者のみアクセス可能
2. **入力検証**: 不正なデータをブロック
3. **ログ記録**: すべての操作を記録
4. **自動エスケープ**: 危険な文字を無害化

---

## 🧪 テストについて

### テストの種類と目的

#### 1. モデレーション判定テスト
AIの判定が正しく動作するかチェック

#### 2. フィルタリングテスト
条件での絞り込みが正しく動作するかチェック

#### 3. 一括操作テスト
複数投稿の処理が正しく動作するかチェック

#### 4. 通報処理テスト
通報の記録と管理が正しく動作するかチェック

### テストの実行方法
```bash
npm test
```

---

## 📊 管理者向けダッシュボード

### 重要な指標
- **総投稿数**: システム内の全投稿数
- **アクティブ投稿**: 現在公開中の投稿
- **通報数**: 未対応の通報件数
- **高リスク投稿**: AIが危険と判定した投稿

### 日々の運用フロー
1. **朝**: 通報された投稿を確認
2. **昼**: 高リスク投稿をレビュー
3. **夕方**: 一日の活動をエクスポート
4. **週次**: データ分析とレポート作成

---

## 🔧 トラブルシューティング

### よくある問題と解決方法

#### Q: 投稿が表示されない
A: 「更新」ボタンをクリックしてデータを再読み込み

#### Q: AIモデレーションが動作しない
A: ネットワーク接続を確認し、ページを再読み込み

#### Q: エクスポートができない
A: ブラウザのポップアップブロックを解除

#### Q: 一括操作が反映されない
A: 選択した投稿が既に削除されていないか確認

---

## 📝 まとめ

この投稿管理システムは、大量の投稿を効率的に管理するための強力なツールです。AIによる自動判定と人間による最終判断を組み合わせることで、安全で健全なコミュニティを維持できます。

### システムの利点
- ⏰ **時間節約**: 自動化により作業時間を大幅削減
- 🎯 **精度向上**: AIと人間の判断を組み合わせ
- 📈 **スケーラブル**: 投稿数が増えても対応可能
- 🔐 **安全性**: 多層的なセキュリティ対策

### 今後の改善点
- リアルタイム通知機能
- より高度なAI判定
- 多言語対応
- モバイルアプリ版

---

**作成日**: 2024年
**バージョン**: 1.0.0
**対象者**: 管理者、運営チーム